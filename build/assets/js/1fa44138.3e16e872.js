"use strict";(self.webpackChunkthree_horizons_docusaurus=self.webpackChunkthree_horizons_docusaurus||[]).push([[429],{3648:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>l,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"phase1-infrastructure","title":"Phase 1: Infrastructure Provisioning","description":"In this phase, we\'ll set up the foundational Azure infrastructure required for the Three Horizons Platform.","source":"@site/docs/phase1-infrastructure.md","sourceDirName":".","slug":"/phase1-infrastructure","permalink":"/docs/phase1-infrastructure","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Introduction","permalink":"/docs/intro"},"next":{"title":"Phase 2: Platform Installation","permalink":"/docs/phase2-platform"}}');var o=r(4848),a=r(8453);const s={sidebar_position:2},i="Phase 1: Infrastructure Provisioning",u={},c=[{value:"Step 1.1: Resource Group Creation",id:"step-11-resource-group-creation",level:2},{value:"Step 1.2: Virtual Network Setup",id:"step-12-virtual-network-setup",level:2},{value:"Step 1.3: Create Key Vault",id:"step-13-create-key-vault",level:2},{value:"Step 1.4: Create Container Registry",id:"step-14-create-container-registry",level:2},{value:"Step 1.5: Create Managed Identity for Workload Identity",id:"step-15-create-managed-identity-for-workload-identity",level:2},{value:"Horizon 1 (Foundation) Validation",id:"horizon-1-foundation-validation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"phase-1-infrastructure-provisioning",children:"Phase 1: Infrastructure Provisioning"})}),"\n",(0,o.jsx)(n.p,{children:"In this phase, we'll set up the foundational Azure infrastructure required for the Three Horizons Platform."}),"\n",(0,o.jsx)(n.h2,{id:"step-11-resource-group-creation",children:"Step 1.1: Resource Group Creation"}),"\n",(0,o.jsx)(n.p,{children:"First, create resource groups to organize your resources:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Login to Azure\naz login\n\n# Set your subscription\naz account set --subscription "<subscription-id>"\n\n# Create resource group for the platform with tags\naz group create \\\n  --name three-horizons-platform \\\n  --location centralus \\\n  --tags Environment=Production Project=ThreeHorizons Owner=PlatformTeam\n\n# Create resource group for shared services\naz group create \\\n  --name three-horizons-shared \\\n  --location centralus \\\n  --tags Environment=Production Project=ThreeHorizons Owner=PlatformTeam\n'})}),"\n",(0,o.jsx)(n.admonition,{title:"NOTE",type:"tip",children:(0,o.jsxs)(n.p,{children:["For production environments, consider using separate resource groups for each major component.\nRead more in the ",(0,o.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/landing-zone/",children:"Azure cloud foundations guide"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"step-12-virtual-network-setup",children:"Step 1.2: Virtual Network Setup"}),"\n",(0,o.jsx)(n.p,{children:"Create the virtual network and subnets:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Create the virtual network with proper address space\naz network vnet create \\\n  --resource-group three-horizons-platform \\\n  --name three-horizons-vnet \\\n  --address-prefix 10.0.0.0/16 \\\n  --subnet-name aks-subnet \\\n  --subnet-prefix 10.0.0.0/22 \\\n  --tags Environment=Production Project=ThreeHorizons\n\n# Create subnet for Azure services\naz network vnet subnet create \\\n  --resource-group three-horizons-platform \\\n  --vnet-name three-horizons-vnet \\\n  --name services-subnet \\\n  --address-prefix 10.0.4.0/24\n\n# Create subnet for private endpoints\naz network vnet subnet create \\\n  --resource-group three-horizons-platform \\\n  --vnet-name three-horizons-vnet \\\n  --name endpoint-subnet \\\n  --address-prefix 10.0.5.0/24 \\\n  --disable-private-endpoint-network-policies true\n"})}),"\n",(0,o.jsx)(n.h2,{id:"step-13-create-key-vault",children:"Step 1.3: Create Key Vault"}),"\n",(0,o.jsx)(n.p,{children:"Create an Azure Key Vault to store secrets:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Create Key Vault with access policies and network rules\naz keyvault create \\\n  --name "th3horizons$(date +%s)" \\\n  --resource-group three-horizons-shared \\\n  --location centralus \\\n  --sku standard \\\n  --enable-rbac-authorization true \\\n  --tags Environment=Production Project=ThreeHorizons Owner=PlatformTeam\n\n# Capture the Key Vault name for future use\nKEY_VAULT_NAME=$(az keyvault list --resource-group three-horizons-shared --query "[0].name" -o tsv)\n\n# Important: Assign yourself the necessary permissions to manage secrets\naz role assignment create \\\n  --role "Key Vault Secrets Officer" \\\n  --assignee "$(az account show --query user.name -o tsv)" \\\n  --scope "$(az keyvault show --name "$KEY_VAULT_NAME" --resource-group three-horizons-shared --query id -o tsv)"\n'})}),"\n",(0,o.jsx)(n.admonition,{title:"IMPORTANT - Key Vault Permissions",type:"warning",children:(0,o.jsx)(n.p,{children:'When using RBAC for Key Vault, you must explicitly assign the "Key Vault Secrets Officer" role to any user or service principal that needs to manage secrets. Without this permission, you\'ll receive a "Caller is not authorized to perform action on resource" error when trying to access or modify secrets.'})}),"\n",(0,o.jsx)(n.h2,{id:"step-14-create-container-registry",children:"Step 1.4: Create Container Registry"}),"\n",(0,o.jsx)(n.p,{children:"Set up Azure Container Registry:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Create Container Registry with geo-replication and unique name\n# Using timestamp to ensure uniqueness\nACR_NAME="threehorizonsreg$(date +%s)"\naz acr create \\\n  --name $ACR_NAME \\\n  --resource-group three-horizons-shared \\\n  --location centralus \\\n  --sku Premium \\\n  --admin-enabled false \\\n  --tags Environment=Production Project=ThreeHorizons\n\n# Store the ACR name for future use (important for subsequent commands)\necho "Container Registry name: $ACR_NAME"\n\n# Enable geo-replication for production workloads\naz acr replication create \\\n  --registry $ACR_NAME \\\n  --location eastus2\n'})}),"\n",(0,o.jsx)(n.h2,{id:"step-15-create-managed-identity-for-workload-identity",children:"Step 1.5: Create Managed Identity for Workload Identity"}),"\n",(0,o.jsx)(n.p,{children:"Create managed identities for modern authentication:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Create user-assigned managed identity\naz identity create \\\n  --name three-horizons-identity \\\n  --resource-group three-horizons-shared \\\n  --tags Environment=Production Project=ThreeHorizons\n\n# Get identity client ID and principal ID\nIDENTITY_CLIENT_ID=$(az identity show --name three-horizons-identity --resource-group three-horizons-shared --query clientId -o tsv)\nIDENTITY_PRINCIPAL_ID=$(az identity show --name three-horizons-identity --resource-group three-horizons-shared --query principalId -o tsv)\n\n# Grant access to Key Vault\naz role assignment create \\\n  --assignee-object-id $IDENTITY_PRINCIPAL_ID \\\n  --assignee-principal-type ServicePrincipal \\\n  --role "Key Vault Secrets User" \\\n  --scope $(az keyvault show --name "$KEY_VAULT_NAME" --resource-group three-horizons-shared --query id -o tsv)\n'})}),"\n",(0,o.jsx)(n.h2,{id:"horizon-1-foundation-validation",children:"Horizon 1 (Foundation) Validation"}),"\n",(0,o.jsx)(n.p,{children:"Validate your infrastructure setup:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Verify resource groups\naz group list --query "[?contains(name, \'three-horizons\')]" -o table\n\n# Verify virtual network and subnets\naz network vnet subnet list \\\n  --resource-group three-horizons-platform \\\n  --vnet-name three-horizons-vnet \\\n  -o table\n\n# Verify Key Vault\naz keyvault show --name "$KEY_VAULT_NAME" -o table\n\n# Verify Container Registry\naz acr show --name $ACR_NAME -o table\n\n# Verify managed identity\naz identity show --name three-horizons-identity --resource-group three-horizons-shared -o table\n'})})]})}function l(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>i});var t=r(6540);const o={},a=t.createContext(o);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);